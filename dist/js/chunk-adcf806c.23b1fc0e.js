(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-adcf806c"],{"00c1":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug3.aa67357d.png"},"10cb":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug5.12d28cfe.png"},"128a":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-break1.2cc8dc1a.png"},"1afe":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun3.9482b98e.png"},"1f15":function(s,t,a){s.exports=a.p+"img/url-error.1657bb95.png"},"27ce":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug1.90467408.png"},"47dd":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun1.303a4695.png"},"4bd1":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-break2.6f364800.png"},"4dad":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun5.dd3eee14.png"},6020:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug2.211987d3.png"},"64ef":function(s,t,a){function r(){var s=function(){var s=this,t=s.$createElement;s._self._c;return s._m(0)},t=[function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("div",{staticClass:"frontmatter-markdown"},[r("nav",{staticClass:"table-of-contents"},[r("ol",[r("li",[r("a",{attrs:{href:"#技巧总结"}},[s._v(" 技巧总结")])]),r("li",[r("a",{attrs:{href:"#分析请求"}},[s._v(" 分析请求")]),r("ol",[r("li",[r("a",{attrs:{href:"#分析请求体变化"}},[s._v(" 分析请求体变化")])]),r("li",[r("a",{attrs:{href:"#脚本运行代码并试用"}},[s._v(" 脚本运行代码并试用")])])])]),r("li",[r("a",{attrs:{href:"#开始逆向"}},[s._v(" 开始逆向")]),r("ol",[r("li",[r("a",{attrs:{href:"#全局搜索"}},[s._v(" 全局搜索")])]),r("li",[r("a",{attrs:{href:"#逆向查找业务逻辑"}},[s._v(" 逆向查找业务逻辑")])])])]),r("li",[r("a",{attrs:{href:"#完成业务代码"}},[s._v(" 完成业务代码")])])])]),r("p",[s._v("本文研究web逆向技术。欢迎来交流。")]),s._v(" "),r("p",[s._v("我们尝试做一下 fanyi.baidu.com的爬虫来理解逆向是什么东西。")]),s._v(" "),r("h3",{attrs:{id:"技巧总结",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#技巧总结",target:"_blank"}},[s._v("§")]),s._v(" 技巧总结")]),s._v(" "),r("p",[s._v("先写在前面哈。")]),s._v(" "),r("ol",[r("li",[s._v("copy link as bash curl ，然后转化下成python代码，快速在python中执行。")]),s._v(" "),r("li",[s._v("debug时可以尝试全局搜索或者基于XHR进行断点处理，利用好call stack栈。")]),s._v(" "),r("li",[s._v("在报错的地方断点，断住之后，使用控制台输出变量的值或调用函数查看返回值。")]),s._v(" "),r("li",[s._v("断点住之后，悬停在函数上可以看到定义函数的位置。")])]),s._v(" "),r("h3",{attrs:{id:"分析请求",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分析请求",target:"_blank"}},[s._v("§")]),s._v(" 分析请求")]),s._v(" "),r("h4",{attrs:{id:"分析请求体变化",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分析请求体变化",target:"_blank"}},[s._v("§")]),s._v(" 分析请求体变化")]),s._v(" "),r("p",[s._v("我们打开网页：fanyi.bidu.com 进行好几次查询。观察下接口和请求体的数据结构。")]),s._v(" "),r("p",[s._v("我们可以看到token值是不变的，而且这个页面也不需要登录就可以访问。那么我们尝试下直接复用token值；")]),s._v(" "),r("p",[s._v("而sign值是变化的，我们猜测它是根据需要查询的内容，在某种规则处理生成的。故这个值需要我们动态生成。")]),s._v(" "),r("img",{staticStyle:{zoom:"20%"},attrs:{src:a("d2d6")}}),s._v(" "),r("h4",{attrs:{id:"脚本运行代码并试用",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#脚本运行代码并试用",target:"_blank"}},[s._v("§")]),s._v(" 脚本运行代码并试用")]),s._v(" "),r("p",[s._v("​    上边的步骤，已经帮助我们猜测参数sign值是动态的了。然后我们如何进一步确认呢？ 我们将请求处理下，放到python下执行下看看。")]),s._v(" "),r("ul",[r("li",[s._v("首先copy link as bash curl")])]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("b042")}}),s._v(" "),r("ul",[r("li",[r("p",[s._v("然后使用工具网站转换一下（https://curlconverter.com/）")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("de9f")}}),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("d9a0")}})]),s._v(" "),r("li",[r("p",[s._v("创建一个PY脚本，运行一下")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("eb7b")}})]),s._v(" "),r("li",[r("p",[s._v("接下来我们试试，查询下其他内容，看下能不能正常调用。结果发现报错了。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("1f15")}})]),s._v(" "),r("li",[r("p",[s._v("好像再次确认了sign值应该是变化的了？那么我们回到网页上找下sign的值是怎么生成的。")])])]),s._v(" "),r("h3",{attrs:{id:"开始逆向",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#开始逆向",target:"_blank"}},[s._v("§")]),s._v(" 开始逆向")]),s._v(" "),r("h4",{attrs:{id:"全局搜索",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#全局搜索",target:"_blank"}},[s._v("§")]),s._v(" 全局搜索")]),s._v(" "),r("p",[s._v("试试用chrome dev tools 的全局搜索看看能不能搜索出啥东西。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("8cde")}}),s._v(" "),r("p",[s._v("我看了下，三个对象方法，变量名或文本组成字符，没啥意义。但是有一个getAcsSign对象，是一个匿名函数返回的一个s变量。试试打个断点看看是不是它。很可惜，不是它。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("128a")}}),s._v(" "),r("h4",{attrs:{id:"逆向查找业务逻辑",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#逆向查找业务逻辑",target:"_blank"}},[s._v("§")]),s._v(" 逆向查找业务逻辑")]),s._v(" "),r("p",[s._v("尝试从请求出发，进行逆向向上进行排查吧")]),s._v(" "),r("p",[s._v("debug下业务uri：/v2transapi?from=zh&to=en")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("4bd1")}}),s._v(" "),r("p",[s._v("第一步，我们找到了send方法，认为是发送请求的动作")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("27ce")}}),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("6020")}}),s._v(" "),r("p",[s._v("第二步，我们看看这个直到这个send函数的调用栈。")]),s._v(" "),r("p",[r("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Glossary/Call_stack",target:"_blank"}},[s._v("Call stack（调用栈） - MDN Web 文档术语表：Web 相关术语的定义 | MDN (mozilla.org)")])]),s._v(" "),r("p",[s._v("我们通过调用栈，回溯下函数调用过程")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("00c1")}}),s._v(" "),r("p",[s._v("然后我们在最后一个匿名函数中（anonymous）找到有ajax请求的具体信息。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("87b3")}}),s._v(" "),r("p",[s._v("尝试下找找w变量")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("10cb")}}),s._v(" "),r("p",[s._v("找到w变量后，我们看到sign值是一个b函数的返回值。b函数的入参是查询内容。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("7450")}}),s._v(" "),r("p",[s._v("我们再找找这个b函数。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("47dd")}}),s._v(" "),r("p",[s._v("拿到这个b函数之后，我们复制到本地新增一个js文件（script.js），然后试着执行一下。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("cefc")}}),s._v(" "),r("p",[s._v("调用下函数后执行，我们发现第一个报错是，r变量没有定义。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("1afe")}}),s._v(" "),r("p",[s._v("找到for函数，我们回到网页上断点看看。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("f670")}}),s._v(" "),r("p",[s._v("找到r变量。那我们复制它的值，在js上定义const，然后再执行看看看，然后发现n函数为定义。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("4dad")}}),s._v(" "),r("p",[s._v("​\t同上，我们回到网页，看看n函数的定义。")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("9f75")}}),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs"}},[s._v("找到n函数之后，我们复制到js文件中，然后再运行下，可以正常运行了，输出的值跟之前debug在网页控制台输出的值是一样的了。\n")])]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("9a6a")}}),s._v(" "),r("h3",{attrs:{id:"完成业务代码",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#完成业务代码",target:"_blank"}},[s._v("§")]),s._v(" 完成业务代码")]),s._v(" "),r("p",[s._v("到了这里就好办了。我们将代码逻辑梳理下，实现一下。")]),s._v(" "),r("ol",[r("li",[s._v("将请求体中的sign变量化，由执行js语句处理生成")]),s._v(" "),r("li",[s._v("将query的值变量话，支持自定义")]),s._v(" "),r("li",[s._v("将响应体整理下，只要目的内容")]),s._v(" "),r("li",[s._v("做个while True循环，优化下日志，提供持续可用")])]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("#! /usr/bin/python3")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# @Time : 2023/3/28 22:53")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('# @Author :"Liu Jin Yao"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# @Email : 592203122@qq.com")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# @File : main.py")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 本文主要逆向fanyi.baidu.com来实现爬虫翻译。")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" requests\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" execjs\n\n...\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("get_sign")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("string")]),s._v("):")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("with")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("open")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"script.js"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"r"')]),s._v(", encoding="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"utf8"')]),s._v(") "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" file:\n        js = file.read()\n        functions = execjs."),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("compile")]),s._v("(js)\n        result = functions.call("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"singn"')]),s._v(", string)  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 回调函数")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result\n\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("fanyiMain")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("query_str")]),s._v("):")]),s._v("\n    sign = get_sign(query_str)\n    data["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'query'")]),s._v("] = query_str\n    data["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'sign'")]),s._v("] = sign\n    response = requests.post("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'https://fanyi.baidu.com/v2transapi'")]),s._v(", params=params, cookies=cookies, headers=headers, data=data)\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("try")]),s._v(":\n        result = response.json()["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'trans_result'")]),s._v("]["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'data'")]),s._v("]["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("]["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"dst"')]),s._v("]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" result\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("except")]),s._v(":\n        print(response.json())\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"sorry i have some error"')]),s._v("\n\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" __name__ == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'__main__'")]),s._v(":\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("while")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("True")]),s._v(":\n        query = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("input")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"请输入翻译的中文: "')]),s._v(")\n        result = fanyiMain(query)\n        print("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"翻译结果为:'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{result}")]),s._v('"')]),s._v(")\n")])]),s._v(" "),r("p",[s._v("打完收工")]),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:a("8202")}})])}];return{render:s,staticRenderFns:t}}const n=r();s.exports={attributes:{},vue:{component:{data:function(){return{templateRender:null}},render:function(s){return this.templateRender?this.templateRender():s("div","Rendering")},created:function(){this.templateRender=n.render,this.$options.staticRenderFns=n.staticRenderFns}}}}},7450:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug6.9d8422ca.png"},8202:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-result.3cae1cbf.png"},"87b3":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-debug4.edd74579.png"},"8cde":function(s,t,a){s.exports=a.p+"img/allSearch.6b66af38.png"},"9a6a":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun7.a4c2c852.png"},"9f75":function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun6.410fab47.png"},b042:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-copyasbashcurl.d9df2aa3.png"},cefc:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun2.2ab6fac9.png"},d2d6:function(s,t,a){s.exports=a.p+"img/web-reverse-01.bd4471ff.png"},d9a0:function(s,t,a){s.exports=a.p+"img/curl2script2.af01a177.png"},de9f:function(s,t,a){s.exports=a.p+"img/curl2script.27964672.png"},eb7b:function(s,t,a){s.exports=a.p+"img/curl2script3.e632183f.png"},f670:function(s,t,a){s.exports=a.p+"img/fanyi-baidu-signFun4.077740f2.png"}}]);
//# sourceMappingURL=chunk-adcf806c.23b1fc0e.js.map