(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dac16fe"],{3606:function(s,a,t){s.exports=t.p+"img/web-per-demo3.fc60f9a3.png"},3982:function(s,a,t){s.exports=t.p+"img/web-per-elementtiming.bcf6548d.png"},4239:function(s,a,t){s.exports=t.p+"img/performance-eventLoad2.5c868cfe.png"},"4ce9":function(s,a,t){s.exports=t.p+"img/web-per-resources2.b7f11797.png"},"4de2":function(s,a,t){s.exports=t.p+"img/diff-png-to-get-time.0e5967c2.png"},"5fce":function(s,a,t){s.exports=t.p+"img/performance-timing2.e8411803.png"},9941:function(s,a,t){s.exports=t.p+"img/web-per-demo2.fb144032.png"},a410:function(s,a,t){function r(){var s=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},a=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("div",{staticClass:"frontmatter-markdown"},[r("nav",{staticClass:"table-of-contents"},[r("ol",[r("li",[r("a",{attrs:{href:"#背景"}},[s._v(" 背景")])]),r("li",[r("a",{attrs:{href:"#常用的性能指标和它的意义"}},[s._v(" 常用的性能指标和它的意义")])]),r("li",[r("a",{attrs:{href:"#performancetiming"}},[s._v(" Performance.Timing")])]),r("li",[r("a",{attrs:{href:"#performancegetentries"}},[s._v(" Performance.getEntries")]),r("ol",[r("li",[r("a",{attrs:{href:"#资源分析-静态资源的加载时间"}},[s._v(" 资源分析-静态资源的加载时间")])]),r("li",[r("a",{attrs:{href:"#资源分析-首屏渲染时间分析"}},[s._v(" 资源分析-首屏渲染时间分析")])]),r("li",[r("a",{attrs:{href:"#资源分析-lcp渲染"}},[s._v(" 资源分析-LCP渲染")])])])]),r("li",[r("a",{attrs:{href:"#cdp协议命令"}},[s._v(" CDP协议命令")])]),r("li",[r("a",{attrs:{href:"#用户情绪时间"}},[s._v(" 用户情绪时间")]),r("ol",[r("li",[r("a",{attrs:{href:"#埋点"}},[s._v(" 埋点")])]),r("li",[r("a",{attrs:{href:"#selenium捕获元素计算时间差"}},[s._v(" selenium捕获元素计算时间差。")])]),r("li",[r("a",{attrs:{href:"#图像技术"}},[s._v(" 图像技术")])]),r("li",[r("a",{attrs:{href:"#to be continue"}},[s._v(" To Be Continue...")])])])])])]),r("h3",{attrs:{id:"背景",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#背景",target:"_blank"}},[s._v("§")]),s._v(" 背景")]),s._v(" "),r("p",[s._v("本文主要探索自动化测试领域中如何获取前端页面性能的一些方式方法，对web的发展历程也有一些阐述。")]),s._v(" "),r("ol",[r("li",[r("p",[s._v("浏览器性能对象的timing属性：window.performance.timing")])]),s._v(" "),r("li",[r("p",[s._v("浏览器性能对象的资源属性： window.performance.getEntries()")])]),s._v(" "),r("li",[r("p",[s._v("selenium调用devtools工具的performance功能。")])]),s._v(" "),r("li",[r("p",[s._v("埋点（）")])]),s._v(" "),r("li",[r("p",[s._v("人为认定时间差")])]),s._v(" "),r("li",[r("p",[s._v("opencv技术")]),s._v(" "),r("br")])]),s._v(" "),r("h3",{attrs:{id:"常用的性能指标和它的意义",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常用的性能指标和它的意义",target:"_blank"}},[s._v("§")]),s._v(" 常用的性能指标和它的意义")]),s._v(" "),r("p",[s._v("LCP（Largest Contentful Paint）：页面最大媒体被加载出来的时间")]),s._v(" "),r("p",[s._v("FP（First Paint）： 首次绘制，开始不同于导航前屏幕内容的时间点\nFCP（First Content Paint）：首次内容绘制，首个元素出现的时间，即首屏时间")]),s._v(" "),r("p",[s._v("全部页面时间：这里我喜欢称之为情绪时间，指全部页面载入时间指从最初启动浏览开始，直到所有元素都被加载完成后，在2秒后仍然没有网络活动的时间")]),s._v(" "),r("br"),s._v(" "),r("h3",{attrs:{id:"performancetiming",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#performancetiming",target:"_blank"}},[s._v("§")]),s._v(" Performance.Timing")]),s._v(" "),r("p",[s._v("在vue等SPA（single-page-application）应用出现之前，W3C针对前端发展过程（Navigation Timing）制定有了Level1和Level2两个版本的加载过程的性能模型和各项指标。如下图：")]),s._v(" "),r("ol",[r("li",[s._v("当导航开始，网页发生跳转（redirect），伪同时，原网页开始销毁（upload）")]),s._v(" "),r("li",[s._v("等待请求回来后，开始根据js、css、xmlhttprequest等生成DOM树，完成渲染过程")]),s._v(" "),r("li",[s._v("加载完成显示至网页上")]),s._v(" "),r("li",[s._v("重复")])]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("f8f3")}}),s._v(" "),r("p",[s._v("而Navigation Timing 的level2 版本，继续深化加强了对获取资源的阶段的规范，定义面向resource的Resource Timing对象，以更细化过程性能。")]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("5fce")}}),s._v(" "),r("p",[s._v("那么怎么说？ 看例：")]),s._v(" "),r("ol",[r("li",[s._v("直接在devtools上的console功能中调用API，进行差值运行，即可得到网页渲染总耗时。")])]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-javascript"}},[r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".performance.timing.loadEventEnd - "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".performance.timing.navigationStart\n# 或者\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".performance.getEntriesByType("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"navigation"')]),s._v(")["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("].loadEventEnd * "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.001")]),s._v("\n")])]),s._v(" "),r("p",[s._v("我们以知乎的一个页面为例观察下。从network模块或者performance模块捕获，或者人为感知下，判断这个页面是渲染大概是2S左右，而network的timeline显示是1.97S。而在红线之后（2S到3.5S这段时间）没做啥事情，那我认为这个页面渲染完全渲染和大部分渲染是成立。那这个1.97S怎么能被获取到呢。")]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("ade2")}}),s._v(" "),r("p",[s._v("我们可以直接在控制台执行API来获取，得到的结果，就是这个Load的值。哦， nice！")]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("4239")}}),s._v(" "),r("p",[s._v("那么，自动化就好办了。存在页面路由List： [A,B,C]，只要打开网页，等待一段时间，然后执行js，就可以获取到性能时间，哇塞，这通用性这么强吗...")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" webdriver\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" time\ndriver = webdriver.Chrome()\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("getPerformanceTime")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("route")]),s._v("):")]),s._v("\n    driver.get(route)\n    time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v(") \n    Thetime = driver.execute_script("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"(window.performance.timing.loadEventEnd - window.performance.timing.navigationStart)/1000"')]),s._v(")\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" {route:Thetime}\n\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("main")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("routeList")]),s._v("):")]),s._v("\n    result = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("map")]),s._v("(getPerformanceTime, routeList)\n")])]),s._v(" "),r("p",[s._v("不过我试过多次，这个时间多少有些误差，不过不大。")]),s._v(" "),r("p",[s._v("下面在列举一种实例（demo）来帮助大家理解，这个方法获得的是什么样的性能时间。")]),s._v(" "),r("p",[s._v("实例框架：python+Flask（MTV）")]),s._v(" "),r("ol",[r("li",[r("p",[s._v("首先定义一个Flask Application。该APP定义有一个/bank/路由函数，返回一个case页面：")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" flask "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" Flask, render_template\n\nAPP = Flask(__name__)\n\n"),r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("@APP.route('/bank/', methods=[\"GET\"])")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("fun1")]),s._v("():")]),s._v("\n    data = {\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"user"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"make"')]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"bank"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"**银行"')]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"cardID"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"08299384829482829934"')]),s._v("\n    }\n    html = render_template("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"case.html"')]),s._v(", **data)\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" html\n\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" __name__ == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'__main__'")]),s._v(":\n    APP.run("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"127.0.0.1"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3478")]),s._v(", debug="),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("True")]),s._v(")  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# http://120.0.0.1:/bank/")]),s._v("\n")])])]),s._v(" "),r("li",[r("p",[s._v("定义case.html页面。页面中需要渲染三个值，分别是user、bank、cardID。")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-html"}},[r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("<!DOCTYPE "),r("span",{pre:!0,attrs:{class:"hljs-meta-keyword"}},[s._v("html")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("lang")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"en"')]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("meta")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("charset")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"UTF-8"')]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("标题"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(">")]),s._v("{{ user }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行名称: {{ bank }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行卡号: {{ cardID }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(">")]),s._v("\n")])])]),s._v(" "),r("li",[r("p",[s._v("当用浏览器访问路由时，我们发现页面比较简单，后台无耗时业务，整体的时间在1S以内 "),r("br"),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("dcb3")}})])]),s._v(" "),r("li",[r("p",[s._v("我们模拟下后台服务有个慢查询。在生成数据前添加等待时间，如下")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("@APP.route('/bank/', methods=[\"GET\"])")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("fun1")]),s._v("():")]),s._v("\n    time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(")  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 模拟慢查询, 记得import time 模块")]),s._v("\n    data = {\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"user"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"make"')]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"bank"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"**银行"')]),s._v(",\n        "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"cardID"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"08299384829482829934"')]),s._v("\n    }\n    html = render_template("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"case.html"')]),s._v(", **data)\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" html\n")])])]),s._v(" "),r("li",[r("p",[s._v("保存服务后，我们再次刷新浏览器，此时可以看到页面加载时间对应地加长了，约2.8s。")]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("9941")}})]),s._v(" "),r("li",[r("p",[s._v("我们看到后台耗时增加是可以被捕获到的。而正常的前端业务为了避免一次性从后台拿太多东西导致耗时较长，用户体验下降，在设计上下可能会将其设计的更为复杂，譬如，公司要求你在页面异步加载一些信息以减少页面渲染时间，提高页面性能。")]),s._v(" "),r("p",[s._v("那我们在case.html添加一个动作来模拟一下异步操作。")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-html"}},[r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("<!DOCTYPE "),r("span",{pre:!0,attrs:{class:"hljs-meta-keyword"}},[s._v("html")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("lang")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"en"')]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("meta")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("charset")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"UTF-8"')]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("标题"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(">")]),s._v("{{ user }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行名称: {{ bank }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行卡号: {{ cardID }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),r("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n\x3c!--    在页面加载完之后，等待"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v("s中，新增渲染出一个元素--\x3e\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".onload = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("setTimeout")]),s._v("(\n            "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n                "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 模拟发起ajax请求后回调。")]),s._v("\n                obj = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"p"')]),s._v(");\n                obj.innerText = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"我是异步查询返回"')]),s._v("\n                body = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"body"')]),s._v(");\n                body.appendChild(obj);\n            }, "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5000")]),s._v("\n        )\n    }\n")]),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(">")]),s._v("\n")])])]),s._v(" "),r("li",[r("p",[s._v("这是我们再观察页面加载时间会发现，加载时间并未如预想那样，会增加5s左右。\n那是因为"),r("strong",[s._v("异步操作是在页面渲染之后发生的，此时performance.Timing对象已经生成，异步操作在不发生改变路由的情况下，该对象不再发生改变。")])])])]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("3606")}}),s._v(" "),r("h3",{attrs:{id:"performancegetentries",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#performancegetentries",target:"_blank"}},[s._v("§")]),s._v(" Performance.getEntries")]),s._v(" "),r("p",[s._v("为了更好的展示效果，这里选择的实例为业务较为复杂些的网页。")]),s._v(" "),r("h4",{attrs:{id:"资源分析-静态资源的加载时间",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#资源分析-静态资源的加载时间",target:"_blank"}},[s._v("§")]),s._v(" 资源分析-静态资源的加载时间")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" resources = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".performance.getEntriesByType("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"resource"')]),s._v(");\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".table(resources);\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" (index "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" resources){\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("var")]),s._v(" obj = resources[index]\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".table({"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"type"')]),s._v(": obj.initiatorType, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"name"')]),s._v(": obj.name, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"time"')]),s._v(":(obj.responseEnd - obj.startTime)*"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.001")]),s._v("});\n}\n")])]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("4ce9")}}),s._v(" "),r("br"),s._v(" "),r("h4",{attrs:{id:"资源分析-首屏渲染时间分析",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#资源分析-首屏渲染时间分析",target:"_blank"}},[s._v("§")]),s._v(" 资源分析-首屏渲染时间分析")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 获取渲染时间  在devtools的resource中新增脚本，并运行")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("let")]),s._v(" paintMetrics = performance.getEntriesByType("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"paint"')]),s._v(");\n"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".table(paintMetrics);\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" (index "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" paintMetrics){\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(paintMetrics[index].startTime);\n}\n")])]),s._v(" "),r("p",[s._v("可以查看到当前页面的开始渲染的时间大概是2.1S。")]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:"D:\\_github\\morebooks\\posts\\md_img\\web-per-demo4.png"}}),s._v(" "),r("h4",{attrs:{id:"资源分析-lcp渲染",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#资源分析-lcp渲染",target:"_blank"}},[s._v("§")]),s._v(" 资源分析-LCP渲染")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-js"}},[s._v("\t"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" PerformanceObserver("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("entryList")]),s._v(") =>")]),s._v(" {\n\t  "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" entry "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("of")]),s._v(" entryList.getEntries()) {\n\t\t"),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'LCP candidate:'")]),s._v(", entry.startTime, entry);\n\t  }\n\t}).observe({"),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'largest-contentful-paint'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("buffered")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v("});\n")])]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("dc92")}}),s._v(" "),r("h3",{attrs:{id:"cdp协议命令",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cdp协议命令",target:"_blank"}},[s._v("§")]),s._v(" CDP协议命令")]),s._v(" "),r("p",[s._v("CDP： chrome-devtools-protocol， 这个的功能比较类似，就不再多赘述")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-text"}},[s._v("# 参考材料\n\tselenium 官文：https://www.selenium.dev/zh-cn/documentation/webdriver/bidirectional/chrome_devtools/\n\tChrome devtools Protocol :https://chromedevtools.github.io/devtools-protocol/\n\t性能时间线模块：https://chromedevtools.github.io/devtools-protocol/tot/PerformanceTimeline/#method-enable\n\t性能模块：https://chromedevtools.github.io/devtools-protocol/tot/Performance/\n")])]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[s._v("\tdriver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Performance.enable'")]),s._v(", {})\n\n\tdriver.get("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'https://10.87.16.54:4433/#/zta/operations_center/behavior_trajectories/user'")]),s._v(")\n\n\tt = driver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Performance.getMetrics'")]),s._v(", {})\n\tprint(t)\n    \n")])]),s._v(" "),r("p",[s._v("也提供下ChatGPT给出的，performance选项录制能力的代码。（暂未验证）")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" webdriver\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium.webdriver.chrome.service "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" Service\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium.webdriver.chrome.options "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" Options\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" json\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 启动Chrome浏览器")]),s._v("\nchrome_options = Options()\nchrome_options.add_argument("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"--headless"')]),s._v(")\nchrome_service = Service("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'/path/to/chromedriver'")]),s._v(")\nchrome_service.start()\ndriver = webdriver.Remote(chrome_service.service_url, options=chrome_options)\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 启用Chrome DevTools Protocol")]),s._v("\ndev_tools = driver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Browser.getVersion"')]),s._v(", {})\nprint("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Chrome version: "')]),s._v(", dev_tools["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"product"')]),s._v("])\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 开始录制性能数据")]),s._v("\ndriver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Performance.enable"')]),s._v(", {})\nprint("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Recording performance data..."')]),s._v(")\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 执行一些操作")]),s._v("\ndriver.get("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://www.example.com"')]),s._v(")\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# ...")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 停止录制性能数据")]),s._v("\nperformance_data = driver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Performance.getMetrics"')]),s._v(", {})\nprint("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Performance data recorded:"')]),s._v(")\nprint(json.dumps(performance_data, indent="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v("))\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 关闭浏览器")]),s._v("\ndriver.quit()\nchrome_service.stop()\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 在上面的代码中，我们首先启动了一个Chrome浏览器实例，并启用了Chrome DevTools Protocol。然后，我们使用Performance.enable命令开始录制性能数据。在执行一些操作后，我们使用Performance.getMetrics命令停止录制性能数据，并将结果打印出来。")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 请注意，要使用Chrome DevTools Protocol，您需要安装Chrome浏览器和Chrome驱动程序，并将Chrome驱动程序的路径传递给Selenium的Service类。另外，您还需要安装chrome-remote-interface Python库，它提供了更高级的API来操作Chrome DevTools Protocol。")]),s._v("\n")])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"用户情绪时间",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#用户情绪时间",target:"_blank"}},[s._v("§")]),s._v(" 用户情绪时间")]),s._v(" "),r("p",[s._v("综上的一些，可以解决一些问题。不过想要获取到前端页面从页面开始渲染，到客户所想要看到所有组件渲染完成的最终页面所需要的时间，上面的方法并不能做到。譬如现在的前端以VUE、React为主流，组件式插槽式布局。大多数元素都是以异步渲染的。所以用户的情绪时间（全部页面加载时间）这个指标还是很重要，但却不能再通过上述的方法来获取了。（当然CDP那一栏玩得6好像可以算到。而资源算法，统计出并行资源，好像也可以算到。不过这很扯啊，要做很多人工介入。）")]),s._v(" "),r("h4",{attrs:{id:"埋点",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#埋点",target:"_blank"}},[s._v("§")]),s._v(" 埋点")]),s._v(" "),r("p",[s._v("这里简单说一种埋点方法，引入PerformanceElementTiming。简单地说，就是在人为认定的最后渲染的元素中，加入elementtiming 属性，最后调用API将其被渲染出来的时间输出。如")]),r("div",{attrs:{elementtiming:"suibian"}},[s._v("11")]),r("p"),s._v(" "),r("p",[s._v("我们修改上边的实例的case.html，在页面h2标签和异步回来的展示数据的P标签，加上elementtiming属性。")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-html"}},[r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("<!DOCTYPE "),r("span",{pre:!0,attrs:{class:"hljs-meta-keyword"}},[s._v("html")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("lang")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"en"')]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("meta")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("charset")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"UTF-8"')]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("标题"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("title")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("head")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("elementtiming")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"firstH2"')]),s._v(">")]),s._v("{{ user }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("h2")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行名称: {{ bank }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("银行卡号: {{ cardID }}"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("div")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("body")]),s._v(">")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),r("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n\x3c!--    在页面加载完之后，等待"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v("s中，新增渲染出一个元素--\x3e\n    "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("window")]),s._v(".onload = "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("setTimeout")]),s._v("(\n            "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("function")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}}),s._v(")")]),s._v("{\n                "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 模拟发起ajax请求后回调。")]),s._v("\n                obj = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".createElement("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"p"')]),s._v(");\n                obj.innerText = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"我是异步查询返回"')]),s._v("\n                obj.setAttribute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"elementtiming"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"lastElement"')]),s._v(");\n                body = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("document")]),s._v(".querySelector("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"body"')]),s._v(");\n                body.appendChild(obj);\n            }\n            , "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5000")]),s._v("\n        )\n    }\n")]),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),r("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("html")]),s._v(">")]),s._v("\n")])]),s._v(" "),r("p",[s._v("然后，我们再次访问页面 ，等待页面加载完成后，执行js")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-js"}},[s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" observer = "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("new")]),s._v(" PerformanceObserver("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("list")]),s._v(") =>")]),s._v(" {\n   list.getEntries().forEach("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("entry")]),s._v(") =>")]),s._v(" {\n       "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// console.log(entry);")]),s._v("\n       "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("console")]),s._v(".log(entry.identifier,"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('" 出现时间："')]),s._v(", entry.startTime);\n   });\n });\n observer.observe({ "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("type")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"element"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("buffered")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("true")]),s._v(" });\n")])]),s._v(" "),r("img",{staticStyle:{zoom:"10%"},attrs:{src:t("3982")}}),s._v(" "),r("h4",{attrs:{id:"selenium捕获元素计算时间差",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#selenium捕获元素计算时间差",target:"_blank"}},[s._v("§")]),s._v(" selenium捕获元素计算时间差。")]),s._v(" "),r("p",[s._v("这种方法，做过web自动化的人，应该都知道。我这里就不赘述了，给出伪代码。这种方法有利有弊，不展开。")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" webdriver\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" time\n\ndriver = webdriver.Chrome()\nstart_time = time.time()\ndriver.get("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://example.com"')]),s._v(")\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" i "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" rang("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("):\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"元素出现"')]),s._v(":\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("break")]),s._v("\n    time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")\nend_time = time.time()\nload_time = end_time - start_time\nprint("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"页面加载时间为："')]),s._v(", load_time, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"秒"')]),s._v(")\ndriver.quit()\n")])]),s._v(" "),r("h4",{attrs:{id:"图像技术",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#图像技术",target:"_blank"}},[s._v("§")]),s._v(" 图像技术")]),s._v(" "),r("p",[s._v("这种方法，我也是苦思很久。有一天灵机一动想到的。将这个需求回归到最初。用户情绪时间就是页面开始渲染的时间到页面不再发生变化的时间。说到这里，你可能也迸发出了很多想法。利用selenium的截图，每0.3或者0.5秒截一张图 ，然后对这些图进行比较。最后两张不一样的图片，就是耗时。咦。这样想，感觉能行。看实例：")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" platform, os\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" subprocess\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" time\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" cv2\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" numpy "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" np\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" base64 "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" b64decode\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" webdriver\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 自动查找Chrome路径")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("iter_chrome_path")]),s._v("():")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"""\n    迭代获取当前系统中Chrome的应用程序路径\n    """')]),s._v("\n    current_platform = platform.system()\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" current_platform == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Windows'")]),s._v(":\n        paths = [\n            "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"C:/Program Files (x86)/Google/Chrome/Application/chrome.exe"')]),s._v(",\n            "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"C:/Program Files/Google/Chrome/Application/chrome.exe"')]),s._v(",\n            "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{os.getenv("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'USERPROFILE'")]),s._v(")}")]),s._v('\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe"')]),s._v(",\n            "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"C:/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"')]),s._v(",\n            "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"C:/Program Files/Microsoft/Edge/Application/msedge.exe"')]),s._v(",\n        ]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" path "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" paths:\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("not")]),s._v(" path:\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("continue")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" os.path.isfile(path):\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("yield")]),s._v(" path\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(":\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" current_platform == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Linux'")]),s._v(":\n            paths = [\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"google-chrome"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"google-chrome-stable"')]),s._v(",\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"google-chrome-beta"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"google-chrome-dev"')]),s._v(",\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"microsoft-edge-stable"')]),s._v("\n            ]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("elif")]),s._v(" current_platform == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Darwin'")]),s._v(":\n            paths = [\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"')]),s._v(",\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge"')]),s._v("\n            ]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(":\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("raise")]),s._v(" FileNotFoundError(\n                "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"unknown platform, could not find the default chrome path."')]),s._v(")\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" path "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" paths:\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("try")]),s._v(":\n                out = subprocess.check_output([path, "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"--version"')]),s._v("],\n                                              timeout="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(")\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("not")]),s._v(" out:\n                    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("continue")]),s._v("\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" out.startswith(("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('b"Google Chrome "')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('b"Microsoft Edge"')]),s._v(")):\n                    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("yield")]),s._v(" path\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("except")]),s._v(" (FileNotFoundError, subprocess.TimeoutExpired):\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("continue")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("raise")]),s._v(" FileNotFoundError("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"Executable chrome file was not found."')]),s._v(")\n    \n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 开启debug模式的chrome")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("open_Chrome")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("debug_port="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("9222")]),s._v(", reopen="),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")])]),s._v("):")]),s._v("\n    has_chrome = os.popen("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"netstat -an | findstr \\"'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{debug_port}")]),s._v('\\""')]),s._v(").read()\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("not")]),s._v(" reopen "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("and")]),s._v(" has_chrome:\n        print("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"chrome端已经打开debug模式"')]),s._v(")\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("True")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'成功'")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" reopen "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("and")]),s._v(" has_chrome:\n        os.system("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'TASKKILL /F /IM chrome.exe'")]),s._v(")\n        os.system("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'taskkill /F /PID chromedriver.exe'")]),s._v(")\n        time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v(")\n    chrome_path = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("next")]),s._v("(iter_chrome_path())\n    command = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{chrome_path}")]),s._v(" --remote-debugging-port="),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{debug_port}")]),s._v(' --incognito"')]),s._v("\n    os.popen(command)\n    time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("3")]),s._v(")\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("True")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'成功'")]),s._v("\n\n\n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# selenium原生的截图，是截图保存。而保存动作会阻塞主进程，这里就改写原来的截图，先将所有图片截图，最后再一并写入。")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-class"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("SelfChrome")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("webdriver.Chrome")]),s._v("):")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("screenshots")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("self, count="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v(", interval="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")])]),s._v("):")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 截图")]),s._v("\n        pngs = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("list")]),s._v("()\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" i "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("range")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("int")]),s._v("(count)):\n            pngs.append(self.execute("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"screenshot"')]),s._v(")["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"value"')]),s._v("])\n            time.sleep(interval)\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(":\n            pngs_iter = pngs.__iter__()\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("del")]),s._v(" pngs\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" i "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("range")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("int")]),s._v("(count)):\n            png = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("next")]),s._v("(pngs_iter)\n            png = b64decode(png.encode("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"ascii"')]),s._v("))\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("try")]),s._v(":\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("with")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("open")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{i}")]),s._v('.png"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"wb"')]),s._v(") "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("as")]),s._v(" f:\n                    f.write(png)\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("except")]),s._v(" OSError:\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("False")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("finally")]),s._v(":\n                "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("del")]),s._v(" png\n                \n"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 二分法递归比较图片获取得出最接近的两份差异样本")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-class"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("class")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("png_calculation")]),s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-meta"}},[s._v("    @classmethod")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("diff_png")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("cls, png_list")]),s._v("):")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('# print("还有文件需要比对：", png_list)')]),s._v("\n        count = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("len")]),s._v("(png_list)\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" count < "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(":\n            print("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"只剩一个文件了。即所有的图片都是不一样或都是一样的。无法确定渲染终点。"')]),s._v(")\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" png_list\n        half = "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("int")]),s._v("(count/"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(")\n        b_img = png_list["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0")]),s._v("]\n        i_img = png_list[half]\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('# print("中间的文件是：", i_img)')]),s._v("\n        img_min = cv2.imread(i_img)\n        img_big = cv2.imread(b_img)\n        diff_data = cv2.subtract(img_big, img_min)\n        diff = np."),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("any")]),s._v("(diff_data)\n        "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v('# print(f"图片（{i_img, b_img}）的有差异：", diff)')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" diff "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("and")]),s._v(" count == "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(":\n            print("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"得出最接近的两份差异样本："')]),s._v(", png_list)\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" png_list\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("elif")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("not")]),s._v(" diff "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("and")]),s._v(" count == "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2")]),s._v(":\n            print("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"剩下的两份数据都没有差异,无法确定渲染终点。"')]),s._v(", png_list)\n            "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" png_list\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("elif")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("not")]),s._v(" diff:\n            next_list = png_list[half:]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(":\n            next_list = png_list["),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("1")]),s._v(":count - half]\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("return")]),s._v(" cls.diff_png(next_list)\n\n \n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" __name__ == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'__main__'")]),s._v(":\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 开启监听方式")]),s._v("\n    options = webdriver.ChromeOptions()\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 无痕模式")]),s._v("\n    options.add_argument("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'--incognito'")]),s._v(")\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 无页面模式")]),s._v("\n    options.add_experimental_option("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"debuggerAddress"')]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"127.0.0.1:9222"')]),s._v(")\n    driver = SelfChrome(executable_path="),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('r"D:\\python36\\chromedriver.exe"')]),s._v(", chrome_options=options)\n    driver.execute_cdp_cmd("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'Network.setCacheDisabled'")]),s._v(", {"),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"cacheDisabled"')]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-literal"}},[s._v("True")]),s._v("})\n    driver.get("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"https://example.com"')]),s._v(")\n    driver.screenshots(count="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v(", interval="),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")\n    time.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("5")]),s._v(")\n    png_list = ["),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('f"'),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{i}")]),s._v('.png"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" i "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("range")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("20")]),s._v(")]\n    png_list = png_list[::"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("-1")]),s._v("]\n    print(png_list)\n    png_calculation.diff_png(png_list) \n")])]),s._v(" "),r("p",[s._v("截图逻辑容易理解了。而这里计算渲染时间的逻辑大概如下："),r("br"),s._v(" "),r("img",{staticStyle:{zoom:"25%"},attrs:{src:t("4de2")}})]),s._v(" "),r("p",[s._v("至于截图这块，如果考虑性能这块的话，用协程来做应该也是可以的")]),s._v(" "),r("pre",[r("code",{pre:!0,attrs:{class:"hljs language-python"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" asyncio\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" time\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" selenium "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" webdriver\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("save_screenshot")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-params"}},[s._v("driver, filename")]),s._v("):")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" asyncio.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")  "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("# 等待0.5秒")]),s._v("\n    driver.save_screenshot(filename)\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("async")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-function"}},[r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("def")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-title"}},[s._v("main")]),s._v("():")]),s._v("\n    driver = webdriver.Chrome()\n    driver.get("),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'https://www.example.com'")]),s._v(")\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("for")]),s._v(" i "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("range")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("):\n        filename = "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("f'screenshot_"),r("span",{pre:!0,attrs:{class:"hljs-subst"}},[s._v("{i}")]),s._v(".png'")]),s._v("\n        task = asyncio.create_task(save_screenshot(driver, filename))\n        driver.save_screenshot(filename)\n        "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" asyncio.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")\n    driver.quit()\n\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" __name__ == "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'__main__'")]),s._v(":\n    asyncio.run(main())\n在上面的代码中，save_screenshot()函数是一个异步函数，其中"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("await")]),s._v(" asyncio.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")等待"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v("秒，driver.save_screenshot()保存截图。\n\n在main()函数中，使用selenium打开网页，然后循环"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("10")]),s._v("次，每次调用save_screenshot()函数来异步截图。在调用异步函数之前，使用selenium的save_screenshot()方法保存截图，并将文件名传递给异步函数。然后使用asyncio.sleep("),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v(")函数等待"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v("秒。最后，关闭浏览器。\n\n请注意，由于selenium的save_screenshot()方法是同步的，因此我们需要使用asyncio库来管理异步操作。在上面的代码中，我们使用了asyncio.create_task()函数来创建异步任务，并使用asyncio.sleep()函数来等待"),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("0.5")]),s._v("秒。同时，我们在调用异步函数之前使用了selenium的save_screenshot()方法保存截图。\n\n\n")])]),s._v(" "),r("h4",{attrs:{id:"to be continue",tabindex:"-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#to be continue",target:"_blank"}},[s._v("§")]),s._v(" To Be Continue...")]),s._v(" "),r("p",[r("br"),r("br")])])}];return{render:s,staticRenderFns:a}}const e=r();s.exports={attributes:{},vue:{component:{data:function(){return{templateRender:null}},render:function(s){return this.templateRender?this.templateRender():s("div","Rendering")},created:function(){this.templateRender=e.render,this.$options.staticRenderFns=e.staticRenderFns}}}}},ade2:function(s,a,t){s.exports=t.p+"img/performance-eventLoad1.be1f0133.png"},dc92:function(s,a,t){s.exports=t.p+"img/web-per-resources3.89340032.png"},dcb3:function(s,a,t){s.exports=t.p+"img/web-per-demo1.40ea477a.png"},f8f3:function(s,a,t){s.exports=t.p+"img/performance-timing.7e63b017.png"}}]);
//# sourceMappingURL=chunk-2dac16fe.9e3287e6.js.map